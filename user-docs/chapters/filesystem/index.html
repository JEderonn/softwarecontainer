<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Filesystems &#8212; softwarecontainer 0.17.0-daf8a0d 2017-01-19 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.17.0-daf8a0d 2017-01-19',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Developer guidelines" href="../developers/index.html" />
    <link rel="prev" title="Troubleshooting" href="../troubleshooting/index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="filesystems">
<span id="id1"></span><h1>Filesystems<a class="headerlink" href="#filesystems" title="Permalink to this headline">¶</a></h1>
<p>The filesystem behavior and layout is documented in this chapter. The document
discusses how the container filesystem is created, where the different mount
points are pulled in from and the mechanisms that changes the behavior of the
filesystem.</p>
<div class="section" id="standard-filesystem">
<h2>Standard filesystem<a class="headerlink" href="#standard-filesystem" title="Permalink to this headline">¶</a></h2>
<p>Each container has a rootfs that is bind mounted as the containers root
filesystem of said container. The creation and bind mounting of the root
filesystem is automated based on a configuration file and a shell script
provided at startup. The process of creating the filesystem and bind mounting
different parts is spread out over several involved parties because of this.
Following is a rough description of the steps taken when setting up the
standard filesystem for SoftwareContainer:</p>
<ol class="arabic simple">
<li>The root filesystem directory is created and the
directory is empty on creation.</li>
<li>It is setup by the <code class="docutils literal"><span class="pre">lxc-softwarecontainer</span></code> script, which is run when
the container is created.</li>
<li>The <code class="docutils literal"><span class="pre">lxc-softwarecontainer</span></code> creates several basic directories
creating a normal unix environment as defined by Filesystem Hierarchy
Standard (FHS).</li>
<li>The filesystem is still mostly empty except for directories and some basic
files such as <code class="docutils literal"><span class="pre">/etc/passwd</span></code> etc.</li>
<li>LXC then mounts some basic directories defined in the
<code class="docutils literal"><span class="pre">libsoftwarecontainer/softwarecontainer.conf</span></code>.</li>
<li>On top of this, non standard mountpoints are also used to mount for example
the gateway directories etc. inside the filesystem. These are defined using
<a class="reference internal" href="../api/index.html#dbus-api"><span class="std std-ref">BindMountFolderInContainer</span></a>, or mounted by
the different gateways.</li>
</ol>
<p>The basic filesystem looks like this on startup:</p>
<div class="highlight-default"><div class="highlight"><pre>.
├── config
└── rootfs
    ├── bin
    ├── dev
    ├── etc
    │   ├── group
    │   ├── machine-id
    │   ├── passwd
    │   ├── pulse
    │   │   └── client.conf
    │   └── resolv.conf
    ├── gateways
    ├── home
    ├── lib
    ├── lib64
    ├── proc
    ├── root
    ├── sbin
    ├── tmp
    └── usr
        ├── lib
        ├── lib64
        ├── local
        └── sbin
</pre></div>
</div>
</div>
<div class="section" id="mountpoints">
<h2>Mountpoints<a class="headerlink" href="#mountpoints" title="Permalink to this headline">¶</a></h2>
<p>Mount points can be created anywhere inside the container filestructure using
the <a class="reference internal" href="../api/index.html#dbus-api"><span class="std std-ref">BindMountFolderInContainer</span></a>  and gateway configurations
which can mount separate files inside the container filesystem.</p>
</div>
<div class="section" id="write-buffered-filesystems">
<h2>Write Buffered Filesystems<a class="headerlink" href="#write-buffered-filesystems" title="Permalink to this headline">¶</a></h2>
<p>A write buffer can be enabled on containers where it is known that the
application may be misbehaving towards the underlying filesystem. This can be
overly high number of writes leading to an early death of storage devices
for example. Enabling the write buffer will provide a layer of
protection for the filesystem by only allowing a final write of the changes in
the upper layer when the container is shutting down.</p>
<p>To enable the write buffer, set the <code class="docutils literal"><span class="pre">enableWriteBuffer</span></code> option in the
<code class="docutils literal"><span class="pre">com.pelagicore.SoftwareContainerAgent.CreateContainer(config)</span></code> call.
This is done using the config parameter in specific, for example, this JSON
config:</p>
<div class="highlight-default"><div class="highlight"><pre><span class="p">[{</span>
    <span class="s">&quot;enableWriteBuffer&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}]</span>
</pre></div>
</div>
<p>The underlying mechanism of the write buffer is the <code class="docutils literal"><span class="pre">OverlayFS</span></code> which mounts a
<code class="docutils literal"><span class="pre">lower</span></code>, <code class="docutils literal"><span class="pre">upper</span></code> and <code class="docutils literal"><span class="pre">work</span></code> directory together into a mountpoint. Files
are written temporarily into the <code class="docutils literal"><span class="pre">work</span></code> directory while being worked on and
then into the <code class="docutils literal"><span class="pre">upper</span></code> directory. The <code class="docutils literal"><span class="pre">upper</span></code> directory is merged on top of
the <code class="docutils literal"><span class="pre">lower</span></code> directory. If a file from the <code class="docutils literal"><span class="pre">lower</span></code> filesystem is opened and
then edited, it will be written in the <code class="docutils literal"><span class="pre">upper</span></code> directory and the user of the
mountpoint will see only the changed file.</p>
<p>If a file is created in the <code class="docutils literal"><span class="pre">lower</span></code> filesystem, the file will be visible in
the merged filesystem, but it will not be part of the <code class="docutils literal"><span class="pre">upper</span></code> or <code class="docutils literal"><span class="pre">work</span></code>
filesystems unless someone opens it from the <code class="docutils literal"><span class="pre">merged</span></code> filesystem, edits and
saves it.</p>
<p>Opening a file in <code class="docutils literal"><span class="pre">upper</span></code> or <code class="docutils literal"><span class="pre">work</span></code> does not create a file in the
<code class="docutils literal"><span class="pre">lower</span></code> filesystem until it is synced to the lower filesystem.</p>
<p>The <code class="docutils literal"><span class="pre">upper</span></code> directory is a temporarily created directory in the <code class="docutils literal"><span class="pre">/tmp</span></code>
filesystem. The <code class="docutils literal"><span class="pre">work</span></code> is also a temporary filesystem.</p>
<div><img alt="&quot;Description of OverlayFS layering&quot;" height="280" src="../../_images/blockdiag-c7e3f81b40a1869963a11505b1406f5478e6ef64.png" width="256" /></div><p>When the container is shutdown and the mountpoints are cleaned up, the
upper filesystem is copied into the lower filesystem causing the filesystem
changes performed during its runtime to be merged into the lower layers.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Filesystems</a><ul>
<li><a class="reference internal" href="#standard-filesystem">Standard filesystem</a></li>
<li><a class="reference internal" href="#mountpoints">Mountpoints</a></li>
<li><a class="reference internal" href="#write-buffered-filesystems">Write Buffered Filesystems</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../troubleshooting/index.html" title="previous chapter">Troubleshooting</a></li>
      <li>Next: <a href="../developers/index.html" title="next chapter">Developer guidelines</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/chapters/filesystem/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Pelagicore AB.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../../_sources/chapters/filesystem/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>