<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Integration guidelines &#8212; softwarecontainer 0.18.0-1621de3 2017-03-22 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.18.0-1621de3 2017-03-22',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Debugging" href="../debugging/index.html" />
    <link rel="prev" title="Gateways" href="../gateways/00-index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="integration-guidelines">
<span id="id1"></span><h1>Integration guidelines<a class="headerlink" href="#integration-guidelines" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes the workflow, major tasks and concepts involved in integrating SoftwareContainer
into a platform. A brief summary of the general steps involved:</p>
<ol class="arabic simple">
<li>Setting up the various IPC mechanisms, that should be reachable from inside containers, on the host system.</li>
<li>Writing service manifests for capabilities of the platform.</li>
<li>Integrating a launcher that interact with SoftwareContainer.</li>
</ol>
<p>Note that SoftwareContainer as a project is split into multiple sub-components, and while it is possible to
use e.g. the container library directly, these guidelines assumes the integration point is the complete
component.</p>
<p>Below follows information about what SoftwareContainer assumes about the host system when handling different
IPC mechanisms and examples of configuration and usage.</p>
<div class="section" id="service-manifests">
<h2>Service manifests<a class="headerlink" href="#service-manifests" title="Permalink to this headline">¶</a></h2>
<p>For details about format and content of service manifests, see <a class="reference internal" href="../service-manifests/index.html#service-manifests"><span class="std std-ref">Service manifests</span></a>
and <a class="reference internal" href="../gateways/00-index.html#gateways"><span class="std std-ref">Gateways</span></a>.</p>
<p>Service manifests should be installed in either <code class="docutils literal"><span class="pre">/usr/local/etc/softwarecontainer//service-manifest.d/</span></code> or
<code class="docutils literal"><span class="pre">/usr/local/etc/softwarecontainer//service-manifest.default.d/</span></code> depending on if the capabilities defined in the manifests
should be applied by default or not. Each manifest is expected to be of type JSON, including the
&#8220;json&#8221; file extension.</p>
<p>Service manifests are read at startup of SoftwareContainer. If two service manifests contain
capabilities with the same name the gateway configurations will be combined (without merging
or removing duplicates), so when the capability&#8217;s gateway configurations are set all
configurations from the manifests are included. For more information on how gateway
configurations are handled, please refer to <a class="reference internal" href="../gateways/00-index.html#gateways"><span class="std std-ref">Gateways</span></a>.</p>
<p>A service manifest&#8217;s content is used when one or more capability is set by a call to <code class="docutils literal"><span class="pre">SetCapabilities</span></code>.
The respective gateway configurations that are part of any service manifest that relates to the specified
capabilities are then applied to the gateways. If any capability is missing, or if any of the gateway
configurations are erroneous, it is treated as a fatal error by SoftwareContainer as it will mean
the systems capabilities are not correctly defined and the environment of any applications would
be in a bad state.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Here is an example service manifest, with the capabilities for getting and setting temperature:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
  <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.temperatureservice.gettemperature&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gateways&quot;</span><span class="p">:</span> <span class="p">[{</span>
          <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;dbus&quot;</span><span class="p">,</span>
          <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[{</span>
              <span class="s2">&quot;dbus-gateway-config-session&quot;</span><span class="p">:</span> <span class="p">[]</span>
          <span class="p">},</span> <span class="p">{</span>
              <span class="s2">&quot;dbus-gateway-config-system&quot;</span><span class="p">:</span> <span class="p">[{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;org.freedesktop.DBus.Introspectable&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Introspect&quot;</span>
              <span class="p">},</span> <span class="p">{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Echo&quot;</span>
              <span class="p">},</span> <span class="p">{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GetTemperature&quot;</span>
              <span class="p">},</span> <span class="p">{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;incoming&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;TemperatureChanged&quot;</span>
              <span class="p">}]</span>
          <span class="p">}]</span>
      <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.temperatureservice.settemperature&quot;</span><span class="p">,</span>
      <span class="s2">&quot;gateways&quot;</span><span class="p">:</span> <span class="p">[{</span>
          <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;dbus&quot;</span><span class="p">,</span>
          <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[{</span>
              <span class="s2">&quot;dbus-gateway-config-session&quot;</span><span class="p">:</span> <span class="p">[]</span>
          <span class="p">},</span> <span class="p">{</span>
              <span class="s2">&quot;dbus-gateway-config-system&quot;</span><span class="p">:</span> <span class="p">[{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;org.freedesktop.DBus.Introspectable&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Introspect&quot;</span>
              <span class="p">},</span> <span class="p">{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;Echo&quot;</span>
              <span class="p">},</span> <span class="p">{</span>
                  <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;outgoing&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;interface&quot;</span><span class="p">:</span> <span class="s2">&quot;com.pelagicore.TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;object-path&quot;</span><span class="p">:</span> <span class="s2">&quot;/com/pelagicore/TemperatureService&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;SetTemperature&quot;</span>
              <span class="p">}]</span>
          <span class="p">}]</span>
      <span class="p">}]</span>
  <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="network-setup">
<span id="id2"></span><h2>Network setup<a class="headerlink" href="#network-setup" title="Permalink to this headline">¶</a></h2>
<p>The network setup of SoftwareContainer is dependent on a network bridge being available on the
host system, if compiled with support for the NetworkGateway. By default, SoftwareContainer will
create such a bridge on the system if it is not already there. This can be changed, so that
SoftwareContainer will simply fail with an error message if the bridge was not available.</p>
<p>The selection of whether or not to create the bridge is a compile-time option given to CMake.
Please see the README for more information about how to set the various CMake options.</p>
<p>For each container a virtual ethernet device will be set up and be bridged to the above mentioned
network bridge on the host system. The virtual ethernet device is then mapped to an ethernet device
inside of the container, configured to be eth0. The LXC template also copies <code class="docutils literal"><span class="pre">/etc/resolv.conf</span></code>
from the host into the container, if it is available in the host. That means the same name servers
will be used in the container as on the host.</p>
<p>In order to configure what traffic is allowed the NetworkGateway is used. The NetworkGateway
converts the configuration it receives into iptables rules which are set for the network device
inside of the container. See <a class="reference internal" href="../gateways/00-index.html#gateways"><span class="std std-ref">Gateways</span></a> for more information.</p>
<div class="section" id="network-setup-sequence">
<h3>Network setup sequence<a class="headerlink" href="#network-setup-sequence" title="Permalink to this headline">¶</a></h3>
<p>On a typical IVI-system, this is how network setup will most likely look, from a SoftwareContainer
perspective.</p>
<ol class="arabic">
<li><p class="first">System boots</p>
<ol class="arabic simple">
<li>System sets up whatever network settings are needed in general</li>
</ol>
</li>
<li><p class="first">SoftwareContainer starts</p>
<blockquote>
<div><ol class="arabic simple">
<li>SoftwareContainer reads all available service manifests</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">SoftwareContainer sets up a bridge interface (if configured to do so)</p>
<ol class="arabic simple">
<li>Bridge interface name and ip settings are read from the main configuration file</li>
<li>SoftwareContainer sets up NAT between the host and the network defined by the bridge</li>
</ol>
</li>
</ol>
<div><svg height="600" viewBox="0 0 448 600" width="448" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="126" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="206" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="286" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="366" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="446" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="526" />
  <rect fill="#ffff99" height="62" stroke="#ffff99" width="192" x="32" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="36" x="128" y="75">System</text>
  <rect fill="#ffff99" height="62" stroke="#ffff99" width="192" x="224" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="320" y="75">SoftwareContainer</text>
  <rect fill="none" height="542" stroke="gray" width="384" x="32" y="38" />
  <path d="M 32 100 L 416 100" fill="none" stroke="gray" />
  <path d="M 224 38 L 224 580" fill="none" stroke="gray" />
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="120" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="66" x="128" y="146">System boot</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="200" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="120" x="128" y="226">System network setup</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="280" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="30" x="128" y="299">Start</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="128" y="312">SoftwareContainer</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="360" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="84" x="320" y="386">Read Manifests</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="440" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="78" x="320" y="466">Create Bridge</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="520" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="78" x="320" y="546">Configure NAT</text>
  <path d="M 128 160 L 128 192" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,199 124,192 132,192 128,199" stroke="rgb(0,0,0)" />
  <path d="M 128 240 L 128 272" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,279 124,272 132,272 128,279" stroke="rgb(0,0,0)" />
  <path d="M 128 320 L 128 340" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 340 L 320 340" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 340 L 320 352" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,359 316,352 324,352 320,359" stroke="rgb(0,0,0)" />
  <path d="M 320 400 L 320 432" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,439 316,432 324,432 320,439" stroke="rgb(0,0,0)" />
  <path d="M 320 480 L 320 512" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,519 316,512 324,512 320,519" stroke="rgb(0,0,0)" />
</svg>
</div>
<p>All of the above will be done globally from a SoftwareContainer perspective, meaning it will not be
done per-container. The below steps are per-container</p>
<ol class="arabic">
<li><p class="first">User starts an app somehow (probably through a launcher)</p>
</li>
<li><p class="first">Launcher creates a container</p>
<ol class="arabic simple">
<li>LXC creates a veth interface on the host and connects it to the bridge</li>
<li>LXC creates a network interface inside the container, and pairs it with the host interface.</li>
</ol>
</li>
<li><p class="first">Launcher sets app capabilities</p>
<blockquote>
<div><ol class="arabic simple">
<li>All gateway configs that are default are read</li>
<li>All gateway configs that are given are read</li>
<li>The gateway configs are applied</li>
<li>The network interface for the container is brought up and given ip address
Note: the IP is automatic, based on container ID</li>
<li>The network gateway applies all the iptables rules given in the configs given by the
capabilities - inside the container.</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Launcher starts app in container</p>
</li>
<li><p class="first">App runs</p>
</li>
<li><p class="first">App stops (probably called by the launcher)</p>
</li>
<li><p class="first">Container is destroyed</p>
<blockquote>
<div><ol class="arabic simple">
<li>LXC brings down and deletes the container network interface</li>
<li>LXC deletes the veth interface on the host</li>
</ol>
</div></blockquote>
</li>
</ol>
<div><svg height="1400" viewBox="0 0 832 1400" width="832" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="126" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="206" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="286" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="366" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="446" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="526" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="606" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="686" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="643" y="766" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="643" y="846" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="926" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="643" y="1006" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="1086" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="1166" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="1246" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="1326" />
  <rect fill="#ffff99" height="62" stroke="#ffff99" width="192" x="32" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="48" x="128" y="75">Launcher</text>
  <rect fill="#ffff99" height="62" stroke="#ffff99" width="192" x="224" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="320" y="75">SoftwareContainer</text>
  <rect fill="#ffff99" height="62" stroke="#ffff99" width="192" x="416" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="18" x="512" y="75">LXC</text>
  <rect fill="#ffff99" height="62" stroke="#ffff99" width="192" x="608" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="54" x="704" y="75">Container</text>
  <rect fill="none" height="1342" stroke="gray" width="768" x="32" y="38" />
  <path d="M 32 100 L 800 100" fill="none" stroke="gray" />
  <path d="M 224 38 L 224 1380" fill="none" stroke="gray" />
  <path d="M 416 38 L 416 1380" fill="none" stroke="gray" />
  <path d="M 608 38 L 608 1380" fill="none" stroke="gray" />
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="120" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="128" y="146">App launched</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="200" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="320" y="226">Container created</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="280" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="512" y="299">Veth created</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="42" x="512" y="312">in host</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="360" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="512" y="379">Veth created</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="512" y="392">in container</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="440" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="120" x="128" y="466">Call SetCapabilities</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="520" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="108" x="320" y="546">Reads default caps</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="600" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="96" x="320" y="626">Reads given caps</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="680" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="320" y="706">Caps applied</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="640" y="760" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="42" x="704" y="779">Veth in</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="704" y="792">container UP</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="640" y="840" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="96" x="704" y="866">Iptables applied</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="920" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="84" x="128" y="946">Run app binary</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="640" y="1000" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="48" x="704" y="1026">App runs</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="1080" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="48" x="128" y="1106">Stop app</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="1160" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="66" x="512" y="1179">Delete veth</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="512" y="1192">in container</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="1240" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="114" x="512" y="1266">Delete veth in host</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="1320" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="114" x="320" y="1346">Container destroyed</text>
  <path d="M 128 160 L 128 180" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 180 L 320 180" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 180 L 320 192" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,199 316,192 324,192 320,199" stroke="rgb(0,0,0)" />
  <path d="M 320 240 L 320 260" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 260 L 512 260" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 512 260 L 512 272" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="512,279 508,272 516,272 512,279" stroke="rgb(0,0,0)" />
  <path d="M 512 320 L 512 352" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="512,359 508,352 516,352 512,359" stroke="rgb(0,0,0)" />
  <path d="M 512 400 L 512 420" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 420 L 512 420" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 420 L 128 432" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,439 124,432 132,432 128,439" stroke="rgb(0,0,0)" />
  <path d="M 128 480 L 128 500" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 500 L 320 500" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 500 L 320 512" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,519 316,512 324,512 320,519" stroke="rgb(0,0,0)" />
  <path d="M 320 560 L 320 592" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,599 316,592 324,592 320,599" stroke="rgb(0,0,0)" />
  <path d="M 320 640 L 320 672" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,679 316,672 324,672 320,679" stroke="rgb(0,0,0)" />
  <path d="M 320 720 L 320 740" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 740 L 704 740" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 704 740 L 704 752" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="704,759 700,752 708,752 704,759" stroke="rgb(0,0,0)" />
  <path d="M 704 800 L 704 832" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="704,839 700,832 708,832 704,839" stroke="rgb(0,0,0)" />
  <path d="M 704 880 L 704 900" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 900 L 704 900" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 900 L 128 912" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,919 124,912 132,912 128,919" stroke="rgb(0,0,0)" />
  <path d="M 128 960 L 128 980" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 980 L 704 980" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 704 980 L 704 992" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="704,999 700,992 708,992 704,999" stroke="rgb(0,0,0)" />
  <path d="M 704 1040 L 704 1060" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 1060 L 704 1060" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 1060 L 128 1072" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,1079 124,1072 132,1072 128,1079" stroke="rgb(0,0,0)" />
  <path d="M 128 1120 L 128 1140" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 128 1140 L 512 1140" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 512 1140 L 512 1152" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="512,1159 508,1152 516,1152 512,1159" stroke="rgb(0,0,0)" />
  <path d="M 512 1200 L 512 1232" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="512,1239 508,1232 516,1232 512,1239" stroke="rgb(0,0,0)" />
  <path d="M 512 1280 L 512 1300" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 1300 L 512 1300" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 1300 L 320 1312" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,1319 316,1312 324,1312 320,1319" stroke="rgb(0,0,0)" />
</svg>
</div>
</div>
</div>
<div class="section" id="wayland-setup">
<h2>Wayland setup<a class="headerlink" href="#wayland-setup" title="Permalink to this headline">¶</a></h2>
<p>In order to have applications access Wayland, one needs to enable the Wayland gateway, and possibly
give access to graphics hardware. Not all applications require direct access to the graphics
hardware, see <a class="reference internal" href="../examples/index.html#wayland-example"><span class="std std-ref">Wayland example</span></a>. A reasonable capability for a Wayland
application would therefore include both the Wayland gateway and a configuration of the Device Node
gateway for any graphics hardware access needed.</p>
<div class="section" id="id3">
<h3>Example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Here is an example manifest defining Wayland access:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">[{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;com.example.wayland-access&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gateways&quot;</span><span class="p">:</span> <span class="p">[{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;wayland&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">true</span>
            <span class="p">}]</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;devicenode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/dri/card0&quot;</span>
            <span class="p">}]</span>
        <span class="p">}]</span>
    <span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-role-of-a-launcher">
<h2>The role of a launcher<a class="headerlink" href="#the-role-of-a-launcher" title="Permalink to this headline">¶</a></h2>
<p>This section describes what typical integration actions are needed to integrate SoftwareContainer with
a launcher. For an overview of the general architecture involving a launcher and SoftwareContainer, see
<a class="reference internal" href="../design/index.html#design"><span class="std std-ref">Design</span></a>.</p>
<p>The assumed scenario in this section is that a launcher want to start an application inside the container.</p>
<p>The launcher should do the following:</p>
<blockquote>
<div><ul class="simple">
<li>Make the app home directory available inside the container.</li>
<li>Set the HOME environment variable in the container point to the above directory.</li>
</ul>
</div></blockquote>
<p>The above actions are performed by interacting with the SoftwareContainerAgent <a class="reference internal" href="../api/index.html#api"><span class="std std-ref">D-Bus API</span></a>.</p>
<div class="section" id="setting-up-a-home-directory-and-home">
<h3>Setting up a home directory and HOME<a class="headerlink" href="#setting-up-a-home-directory-and-home" title="Permalink to this headline">¶</a></h3>
<p>By calling <code class="docutils literal"><span class="pre">BindMount</span></code> and passing a path on the host that will be mounted inside
the container at the location specified as the <code class="docutils literal"><span class="pre">pathInContainer</span></code> argument, a directory is
made available to any application started in the container later.</p>
<p>The path inside the container is intended to be set as the <code class="docutils literal"><span class="pre">HOME</span></code> environment variable inside the
container. The variable is set when calling <code class="docutils literal"><span class="pre">Execute</span></code> with an appropriate dictionary passed as
the  <code class="docutils literal"><span class="pre">env</span></code> argument.</p>
</div>
</div>
<div class="section" id="traffic-shaping">
<h2>Traffic Shaping<a class="headerlink" href="#traffic-shaping" title="Permalink to this headline">¶</a></h2>
<p>Linux offers a very rich set of tools for managing and manipulating the transmission of packets.
Those tools can be used to manage and shape traffic on SoftwareContainer.</p>
<p>The Linux network routing, firewalling and traffic control subsystem is very powerful and flexible
and have grown to be a very mature stack of tools. To glance those solutions the linux
documentation project would be very good resource to start. Please check
<a class="reference external" href="http://www.tldp.org/HOWTO/html_single/Traffic-Control-HOWTO/#intro">TLDP</a>
for documentation on the concepts of traffic control in Linux. <a class="reference external" href="http://lartc.org/howto/">Linux Advanced Routing &amp; Traffic Control</a>
is another good source that presents deep information about the topic.</p>
<p>Even though there are many ways of shaping the traffic, what we describe here is to give brief information
with examples about one particular way of shaping network traffic of a container to prevent possible
network starvation scenarios.</p>
<p>This can be done via the network classifier cgroup. The network classifier cgroup provides an interface
to tag network packets with a class identifier. It is possible to make each SoftwareContainer produce
network packages with different class id using different capabilities to set network classifier cgroup.
This way <code class="docutils literal"><span class="pre">tc</span></code> can be used to assign different priorities to packets from different cgroups.</p>
<p>The network classifier cgroup is supported to mark network packages by the <a class="reference internal" href="../gateways/00-index.html#cgroups-gateway"><span class="std std-ref">CGroups gateway</span></a>.</p>
<div class="section" id="id4">
<h3>Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>Here is an example way of marking network packages belonging to a container. The example aims to create
a SoftwareContainer, configure its related gateways to mark packages and finally present a small howto
about shaping traffic on host.</p>
<p>Create a service manifest to let container send/receive files on network and mark network classifier
cgroup. Then add this manifest to default manifest folder :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test.cap.netcls&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gateways&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;setting&quot;</span><span class="p">:</span> <span class="s2">&quot;net_cls.classid&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;0x100001&quot;</span>
                        <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;cgroups&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;network.accept-ping&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gateways&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;OUTGOING&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;protocols&quot;</span><span class="p">:</span> <span class="s2">&quot;icmp&quot;</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;protocols&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;udp&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;tcp&quot;</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;INCOMING&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;allow&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;protocols&quot;</span><span class="p">:</span> <span class="s2">&quot;icmp&quot;</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;protocols&quot;</span><span class="p">:</span> <span class="p">[</span>
                                        <span class="s2">&quot;udp&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;tcp&quot;</span>
                                    <span class="p">]</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;network&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, from the build directory, run the agent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">-</span><span class="n">E</span> <span class="n">softwarecontainer</span><span class="o">-</span><span class="n">agent</span>
</pre></div>
</div>
<p>Next, we will start a new container:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdbus</span> <span class="n">call</span> <span class="o">--</span><span class="n">system</span> \
<span class="o">--</span><span class="n">dest</span> <span class="n">com</span><span class="o">.</span><span class="n">pelagicore</span><span class="o">.</span><span class="n">SoftwareContainerAgent</span> \
<span class="o">--</span><span class="nb">object</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">pelagicore</span><span class="o">/</span><span class="n">SoftwareContainerAgent</span> \
<span class="o">--</span><span class="n">method</span> <span class="n">com</span><span class="o">.</span><span class="n">pelagicore</span><span class="o">.</span><span class="n">SoftwareContainerAgent</span><span class="o">.</span><span class="n">Create</span> \
<span class="s1">&#39;[{&quot;enableWriteBuffer&quot;: false}]&#39;</span>

</pre></div>
</div>
<p>Now we can set our prepared capabilities to mark network packages :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gdbus</span> <span class="n">call</span> <span class="o">--</span><span class="n">system</span> \
<span class="o">--</span><span class="n">dest</span> <span class="n">com</span><span class="o">.</span><span class="n">pelagicore</span><span class="o">.</span><span class="n">SoftwareContainerAgent</span> \
<span class="o">--</span><span class="nb">object</span><span class="o">-</span><span class="n">path</span> <span class="o">/</span><span class="n">com</span><span class="o">/</span><span class="n">pelagicore</span><span class="o">/</span><span class="n">SoftwareContainerAgent</span> \
<span class="o">--</span><span class="n">method</span> <span class="n">com</span><span class="o">.</span><span class="n">pelagicore</span><span class="o">.</span><span class="n">SoftwareContainerAgent</span><span class="o">.</span><span class="n">SetCapabilities</span> \
<span class="mi">0</span> \
<span class="s2">&quot;[&#39;network.accept-ping&#39;,</span>
<span class="s1">&#39;test.cap.netcls&#39;</span><span class="p">]</span><span class="s2">&quot;</span>

</pre></div>
</div>
<p>In this stage every network package within the container SC-0 will be marked with class id 0x100001. This
means every network package from this container will be marked with major class ID value 10 and minor
class ID value 1. So it is wise to configure traffic shaping with <code class="docutils literal"><span class="pre">tc</span></code> (please check <a class="reference external" href="http://www.tldp.org/HOWTO/html_single/Traffic-Control-HOWTO/#components">tc components</a>
for more information about tc) according to indicated class IDs in the host :</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tc</span> <span class="n">qdisc</span> <span class="n">add</span> <span class="n">dev</span> <span class="n">eth0</span> <span class="n">root</span> <span class="n">handle</span> <span class="mi">10</span><span class="p">:</span> <span class="n">htb</span>
<span class="n">sudo</span> <span class="n">tc</span> <span class="k">class</span> <span class="nc">add</span> <span class="n">dev</span> <span class="n">eth0</span> <span class="n">parent</span> <span class="mi">10</span><span class="p">:</span> <span class="n">classid</span> <span class="mi">10</span><span class="p">:</span><span class="mi">1</span> <span class="n">htb</span> <span class="n">rate</span> <span class="mi">1</span><span class="n">mbit</span>
<span class="n">sudo</span> <span class="n">tc</span> <span class="nb">filter</span> <span class="n">add</span> <span class="n">dev</span> <span class="n">eth0</span> <span class="n">parent</span> <span class="mi">10</span><span class="p">:</span> <span class="n">protocol</span> <span class="n">ip</span> <span class="n">prio</span> <span class="mi">10</span> <span class="n">handle</span> <span class="mi">1</span><span class="p">:</span> <span class="n">cgroup</span>
</pre></div>
</div>
<p>With this setup SC-0 can consume only up to 1 mbit bitrate. For more information and examples it is
suggested to visit following</p>
<ul class="simple">
<li><a class="reference external" href="http://lartc.org/howto/lartc.qdisc.filters.html">http://lartc.org/howto/lartc.qdisc.filters.html</a></li>
<li><a class="reference external" href="http://www.tldp.org/HOWTO/html_single/Traffic-Control-HOWTO/">http://www.tldp.org/HOWTO/html_single/Traffic-Control-HOWTO/</a></li>
<li><a class="reference external" href="https://www.kernel.org/doc/Documentation/cgroup-v1/net_cls.txt">https://www.kernel.org/doc/Documentation/cgroup-v1/net_cls.txt</a></li>
</ul>
</div>
</div>
<div class="section" id="working-with-shared-memory-in-containers">
<h2>Working with shared memory in containers<a class="headerlink" href="#working-with-shared-memory-in-containers" title="Permalink to this headline">¶</a></h2>
<p>There are two main types of shared memory in Linux systems: POSIX shm and SysV IPC. POSIX shm
generally assumes that a there is a tmpfs mounted on <code class="docutils literal"><span class="pre">/dev/shm</span></code> where one can handle the shared
memory objects, which are accessed through its own family of API calls. POSIX shm is not
namespace-aware.</p>
<p>SysV IPC uses mechanisms built-in to the kernel (internally it uses a tmpfs as well, but it is
hidden). Among other things, SysV IPC supports shared memory, and is namespace-aware.</p>
<div class="section" id="how-to-use-this-inside-containers">
<h3>How to use this inside containers?<a class="headerlink" href="#how-to-use-this-inside-containers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="posix-shm">
<h4>POSIX SHM<a class="headerlink" href="#posix-shm" title="Permalink to this headline">¶</a></h4>
<p>Using POSIX SHM requires you to have <code class="docutils literal"><span class="pre">/dev/shm</span></code> inside the container. To accomplish this, one
simply has to mount it, which should be done through the <a class="reference internal" href="../gateways/00-index.html#file-gateway"><span class="std std-ref">File gateway</span></a>.</p>
</div>
<div class="section" id="sysv-ipc">
<h4>SysV IPC<a class="headerlink" href="#sysv-ipc" title="Permalink to this headline">¶</a></h4>
<p>There is currently no easy way to, with the LXC API, stay in the same IPC namespace when creating a
new container. It is equally hard to attach to an existing IPC namespace (for example, one to use to
share data between host and container) when the container is already set up.</p>
<p>It is however possible, when using the <code class="docutils literal"><span class="pre">attach()</span></code> API call on the LXC container, to specify not to
enter a new IPC namespace, so it is indeed possible to share memory between host and container when
running a specific command. This would only be local to that command or application, and not to the
whole container. The init process and any other processes running inside the container that are not
instructed to share their IPC namespace would still live in a separate IPC namespace. This method is
however not implemented in SoftwareContainer, so currently any calls to <code class="docutils literal"><span class="pre">attach()</span></code> from
SoftwareContainer will always enter new namespaces (including the IPC namespace), as this is the
default behavior in LXC.</p>
</div>
</div>
</div>
<div class="section" id="write-buffered-filesystems">
<h2>Write buffered filesystems<a class="headerlink" href="#write-buffered-filesystems" title="Permalink to this headline">¶</a></h2>
<p>To enable the write buffers for the filesystems of an app, you need to specify
a short json object that is sent to the <code class="docutils literal"><span class="pre">com.pelagicore.SoftwareContainerAgent.Create(id)</span></code>
method. What will happen is described in detail in the <a class="reference internal" href="../filesystem/index.html#filesystems"><span class="std std-ref">Filesystem</span></a>
chapter.</p>
<div class="section" id="id5">
<h3>Example<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The following snippet will create a container where a write buffer will be
created for all filesystems in that container:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[{</span>
    <span class="s2">&quot;enableWriteBuffer&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}]</span>
</pre></div>
</div>
<p>The following example will disable write buffers for all filesystems within
the container:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[{</span>
    <span class="s2">&quot;enableWriteBuffer&quot;</span><span class="p">:</span> <span class="n">false</span>
<span class="p">}]</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Integration guidelines</a><ul>
<li><a class="reference internal" href="#service-manifests">Service manifests</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#network-setup">Network setup</a><ul>
<li><a class="reference internal" href="#network-setup-sequence">Network setup sequence</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wayland-setup">Wayland setup</a><ul>
<li><a class="reference internal" href="#id3">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-role-of-a-launcher">The role of a launcher</a><ul>
<li><a class="reference internal" href="#setting-up-a-home-directory-and-home">Setting up a home directory and HOME</a></li>
</ul>
</li>
<li><a class="reference internal" href="#traffic-shaping">Traffic Shaping</a><ul>
<li><a class="reference internal" href="#id4">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-shared-memory-in-containers">Working with shared memory in containers</a><ul>
<li><a class="reference internal" href="#how-to-use-this-inside-containers">How to use this inside containers?</a><ul>
<li><a class="reference internal" href="#posix-shm">POSIX SHM</a></li>
<li><a class="reference internal" href="#sysv-ipc">SysV IPC</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#write-buffered-filesystems">Write buffered filesystems</a><ul>
<li><a class="reference internal" href="#id5">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../gateways/00-index.html" title="previous chapter">Gateways</a></li>
      <li>Next: <a href="../debugging/index.html" title="next chapter">Debugging</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/chapters/integration-guidelines/00-index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Pelagicore AB.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../_sources/chapters/integration-guidelines/00-index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>